<html>
<title>Moirai UI: Search</title>

<body>
  <form method="POST" enctype="multipart/form-data">
    <table>
      {% for k, v in features %}
      <tr>
        <td>{{k}}</td>
        <td>{{v|safe}}</td>
      </tr>
      {% endfor %}
      <tr>
        <td>Confidence Threshold
        </td>
        <td><input type="text" name="threshold" value="{{threshold}}"/></td>
        </td>
      </tr>
      <tr>
        <td>#Neighbors</td>
        <td><select name="num_neighbors">
            {% for v in [1,5,10,25,50,100,9999] %}
            <option value="{{v}}" {% if v == num_neighbors %}selected {%endif%}>{{v}}</option>
            {% endfor%}
        </select></td>
      </tr>
    </table>
    <input type="submit" name="go" />
  </form>
  <hr/>
  {% if matches %}
  Matches at >= {{threshold}} confidence.
  <table>
    <tr> 
      <th>
        Label
      </th>
      <th>
        Item
      </th>
     
      <th>
	{% if has_precisions %}
	Confidence [0.0-1.0]
	{% else %}
	Raw Distance (Non-normalized/calibrated)
	{% endif %}
      </th>
    </tr>
    {% for match in matches %}
    <tr>
      <td>
        {{match.label}}
      </td>
      <td>
	{{match.metadata|safe}}
      </td>
      <td align="right">
	{% if has_precisions %} 
        {{match.precision}}
	{% else %}
	{{match.distance}}
	{% endif %}
	
      </td>
    </tr>
    {% endfor %}
  </table>
  {% elif ready %}
  <!-- No search made -->
  {% else %}
  <b>No matches</b>
  {% endif %}
  {% if verbose %}
  {% if results %}

  <table>
    <tr>
      <th>Target</th>
      <th>Target Label</th>
      <th>DeepDistance</th>
      <th>Precision</th>
      <th>Is Spoofing (@99 precision)</th>
      <th>Is Spoofing (@95 precision)</th>
    </tr>
    {% for result in results %}
    <tr>
      <td> {{result.metadata|safe}} </td>
      <td> {{result.label}} </td>
      <td> {{result.distance}} </td>
      <td> {{result.precision}} </td>
      <td> 
        {% if result.precision >= 0.99 %}
	<b>Y</b>
	{% else %}
	N
	{% endif %}
      </td>
      <td> 
        {% if result.precision >= 0.95 %}
	<b>Y</b>
	{% else %}
	N
	{% endif %}
      </td>
      
    </tr>
    {% endfor %}
  </table>
  {% endif %}
  {% endif %}
</body>
<html>
